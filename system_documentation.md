# ğŸ“Š æ”¶æ”¯èˆ‡ç”Ÿæ´»ç®¡ç†ç³»çµ± (Expense & Life Manager) ç³»çµ±æ–‡ä»¶

é€™æ˜¯ä¸€ä»½é‡å° **æ”¶æ”¯èˆ‡ç”Ÿæ´»ç®¡ç†å·¥å…·** çš„ç³»çµ±åˆ†æèˆ‡é–‹ç™¼æ–‡ä»¶ã€‚æœ¬ç³»çµ±ç‚ºå‰ç«¯ä¸»å°ä¹‹æ‡‰ç”¨ç¨‹å¼ï¼Œçµåˆ localStorage èˆ‡ Supabase è¼•é‡é›²ç«¯å‚™ä»½ï¼Œæ—¨åœ¨å”åŠ©ç”¨æˆ¶è¼•é¬†ç®¡ç†å›ºå®šæ”¯å‡ºã€æ—¥å¸¸ç”Ÿæ´»è²»ã€å°ˆæ¡ˆé ç®—ä»¥åŠè³‡ç”¢è¦åŠƒã€‚

---

## 1. ç³»çµ±æ¶æ§‹åœ– (System Architecture)

```mermaid
graph TD
    User((ä½¿ç”¨è€…)) -->|æ“ä½œä»‹é¢| HTML[index.html]
    HTML -->|æ¨£å¼æ¸²æŸ“| CSS[style.css]
    HTML -->|äº‹ä»¶èˆ‡é‚è¼¯| JS[js/*.js æ¨¡çµ„]
    
    subgraph Browser [ç€è¦½å™¨ç’°å¢ƒ]
        JS <-->|è®€å¯«ç›®å‰ç‹€æ…‹| LS[(LocalStorage)]
        JS -->|ç¹ªè£½çµ±è¨ˆåœ–| ChartJS[Chart.js]
    end
    
    subgraph Cloud [Supabase é›²ç«¯æœå‹™]
        JS <-->|Auth ç™»å…¥/è¨»å†Š| SupabaseAuth[Authentication]
        JS <-->|å…¨ç«™ç‹€æ…‹å‚™ä»½ / é‚„åŸ| SupabaseDB[(PostgreSQL user_backups)]
    end

    style User fill:#f9f,stroke:#333,stroke-width:2px
    style LS fill:#eee,stroke:#333,stroke-dasharray: 5 5
    style SupabaseDB fill:#4ade80,stroke:#333
```

---

## 2. æŠ€è¡“å †ç–Š (Tech Stack)

| é¡åˆ¥ | æŠ€è¡“/å·¥å…· | èªªæ˜ |
| :--- | :--- | :--- |
| **æ ¸å¿ƒèªè¨€** | HTML5, CSS3, Vanilla JavaScript (ES6+) | ç„¡æ¡ç”¨å¤§å‹å‰ç«¯æ¡†æ¶ï¼Œä½¿ç”¨åŸç”Ÿ JS é€²è¡Œæ¨¡çµ„åŒ–é–‹ç™¼ |
| **æ¨£å¼è¨­è¨ˆ** | Native CSS (Variables) | é€é CSS è®Šæ•¸å¯¦ç¾æ·±è‰²/æ·ºè‰²æ¨¡å¼åˆ‡æ›åŠ RWD éŸ¿æ‡‰å¼è¨­è¨ˆ |
| **è³‡æ–™å„²å­˜ (åœ°ç«¯)** | Web Storage API (LocalStorage) | æ‡‰ç”¨ç¨‹å¼æ ¸å¿ƒç‹€æ…‹ï¼Œæä¾›é›¢ç·šèˆ‡å¿«é€Ÿå­˜å–é«”é©— |
| **è³‡æ–™å„²å­˜ (é›²ç«¯)** | [Supabase](https://supabase.com/) | æä¾›ä½¿ç”¨è€…èªè­‰ (Auth) åŠ PostgreSQL (å‚™ä»½ JSON ç‹€æ…‹) |
| **åœ–è¡¨ç¹ªè£½** | [Chart.js](https://www.chartjs.org/) | ç¹ªè£½å„åˆ†é¡æ”¯å‡ºåœ“é¤…åœ–ã€é•·æ¢åœ–åŠè¿‘ 6 å€‹æœˆè¶¨å‹¢åœ– |
| **å­—é«”èˆ‡åœ–ç¤º** | Google Fonts, Font Awesome | æä¾› Noto Sans TC / Noto Serif TC å­—é«”èˆ‡ SVG åœ–ç¤º |

---

## 3. åŠŸèƒ½æ¨¡çµ„è©³è§£ (Features)

ç³»çµ±åŠƒåˆ†ç‚ºäº”å¤§æ ¸å¿ƒæ¨¡çµ„ï¼ˆåˆ†é ï¼‰ï¼Œæ¶µè“‹å¤šé¢å‘çš„è²¡å‹™èˆ‡ç”Ÿæ´»ç®¡ç†ï¼š

### 3.1 ç”Ÿæ´»è²»è¨˜å¸³ (Life Expenses)
*   **æ”¶æ”¯æ˜ç´°ç®¡ç†**ï¼šè¨˜éŒ„æ¯æ—¥æ”¯å‡ºèˆ‡æ”¶å…¥ï¼Œä¾æœˆä»½è‡ªç”±åˆ‡æ›æŸ¥çœ‹ã€‚
*   **åˆ†é¡é ç®—æ§åˆ¶**ï¼šå¯è‡ªè¨‚æ”¶å…¥/æ”¯å‡ºåˆ†é¡ï¼Œä¸¦å°å–®ä¸€åˆ†é¡è¨­å®šã€Œæœˆé ç®—ã€ã€‚
*   **æœˆåº¦ç¸½è¦½**ï¼šè‡ªå‹•è¨ˆç®—æœ¬æœˆå¯¦éš›æ”¶å…¥ã€æ”¯å‡ºèˆ‡çµé¤˜ï¼Œä¸¦é€éé€²åº¦æ¢é¡¯ç¤ºèŠ±è²»æ¯”ä¾‹ã€‚

### 3.2 æ”¶æ”¯åˆ†æ (Analysis)
*   **è²¡å‹™å„€è¡¨æ¿**ï¼šè¨­å®šé ä¼°æœˆæ”¶å…¥ï¼Œç³»çµ±è‡ªå‹•è¨ˆç®—æ‰£é™¤å›ºå®šèˆ‡ç”Ÿæ´»æ”¯å‡ºå¾Œçš„ã€Œæ¯æœˆçµé¤˜ã€ã€‚å¯é¸æ“‡æ˜¯å¦æ‰£é™¤å°ˆæ¡ˆé å®šé‡‘ã€‚
*   **åœ–è¡¨è¦–è¦ºåŒ–**ï¼š
    *   **è¨‚é–±åˆ†é¡åˆ†æ**ï¼šåŒ…å«å¹´åº¦é ä¼°ç¸½æ”¯å‡ºï¼Œåœ“é¤…åœ–/é•·æ¢åœ–ï¼Œæ”¯æ´æŒ‰å¹´/æŒ‰æœˆæª¢è¦–å›ºå®šæ”¯å‡ºã€‚
    *   **ç”Ÿæ´»è²»åˆ†é¡åˆ†æ**ï¼šä¾æœˆä»½æª¢è¦–ç”Ÿæ´»è²»å„åˆ†é¡çš„ä½”æ¯”åœ“é¤…åœ–ã€‚
    *   **è¶¨å‹¢åœ–**ï¼šè¿‘ 6 å€‹æœˆçš„ç¸½æ”¶æ”¯æŠ˜ç·šè¶¨å‹¢åœ–ã€‚

### 3.3 å›ºå®šæ”¯å‡º (Fixed Expenses / Management)
*   **è¨‚é–±èˆ‡åˆ†æœŸç®¡ç†**ï¼šæ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤(CRUD)å›ºå®šæ”¯å‡ºæˆ–è¨‚é–±é …ç›®ã€‚
*   **å¤šå¹£åˆ¥èˆ‡é€±æœŸ**ï¼šæ”¯æ´ TWD, USD, JPY ç­‰è‡ªå‹•è½‰æ›åŒ¯ç‡ï¼Œä¸¦å¯è¨­å®šæ¯æœˆã€æ¯å­£ã€æ¯åŠå¹´ã€æ¯å¹´æˆ–å–®æ¬¡ç¹³è²»ã€‚ç‹€æ…‹å€åˆ†ã€Œé€²è¡Œä¸­ã€æˆ–ã€Œå·²çµæŸã€ã€‚
*   **è³‡æ–™å‚™ä»½/åŒ¯å‡º**ï¼šæä¾›æ‰‹å‹•åŒ¯å‡º/åŒ¯å…¥å…¨ç«™å‚™ä»½ JSON æª”åŠæ¸…é™¤æ‰€æœ‰è³‡æ–™åŠŸèƒ½ã€‚

### 3.4 è³‡ç”¢è©¦ç®— (Wealth Calculator)
*   **è¤‡åˆ©è©¦ç®—æ¨¡å‹**ï¼šå°‡è³‡ç”¢åŠƒåˆ†ç‚ºã€Œé«˜é¢¨éšª(æŠ•è³‡)ã€èˆ‡ã€Œä½é¢¨éšª(ç¾é‡‘/æ´»å­˜)ã€å…©å¤§éƒ¨ä½ã€‚
*   **ç›®æ¨™é æ¸¬**ï¼šè¼¸å…¥ç›®æ¨™é”æˆçš„ç¸½é‡‘é¡ã€ç•¶å‰è³‡ç”¢ã€æ¯æœˆå„éƒ¨ä½æŠ•å…¥èˆ‡é ä¼°å¹´åŒ–å ±é…¬/åˆ©ç‡ï¼Œè‡ªå‹•ç¹ªè£½è³‡ç”¢æˆé•·æ›²ç·šåœ–ä¸¦é ä¼°é”æˆä¹‹å¹´æœˆèˆ‡ç¸½æŠ•å ±ç‡ã€‚

### 3.5 å°ˆæ¡ˆé ç®— (Projects / Events)
*   **ç¨ç«‹é ç®—å°ˆæ¡ˆ**ï¼šä¾‹å¦‚æ—…éŠã€è³¼è»Šç­‰ç‰¹å®šç›®æ¨™ï¼Œå¯è¨­å®šç¸½é ç®—èˆ‡èµ·è¨–æ—¥æœŸã€‚
*   **å°ˆæ¡ˆæ˜ç´°è¨˜å¸³**ï¼šåœ¨å°ˆæ¡ˆå…§ç¨ç«‹è¨˜éŒ„å„é …èŠ±è²»ï¼Œæ”¯æ´å­åˆ†é¡ï¼Œä¸¦é¡¯ç¤ºå·²èŠ±è²»èˆ‡å‰©é¤˜é ç®—ç™¾åˆ†æ¯”ã€‚
*   **é å‚™é‡‘æ‰£é™¤é€£å‹•**ï¼šåœ¨åˆ†æçœ‹æ¿ä¸­å¯é€£å‹•æ‰£é™¤æ¯æœˆæ‡‰å­˜ä¸‹çš„ã€Œå°ˆæ¡ˆé å®šé‡‘ã€ï¼Œä»¥åæ˜ çœŸå¯¦çš„å‰©é¤˜å¯ç”¨è³‡é‡‘ã€‚

### 3.6 é›²ç«¯åŒæ­¥ (Cloud Sync)
*   **ç°¡å–®å¸³æˆ¶ç³»çµ±**ï¼šæä¾› Email èˆ‡å¯†ç¢¼ç™»å…¥/è¨»å†ŠåŠŸèƒ½ã€‚
*   **è‡ªå‹•å‚™ä»½èˆ‡é‚„åŸ**ï¼šæœ‰ç™»å…¥çš„ç‹€æ…‹ä¸‹ï¼Œä»»ä½•è³‡æ–™æˆ–è¨­å®šè®Šæ›´çš†æœƒè‡ªå‹•æ‰“åŒ… LocalStorage JSON ä¸¦ä¸Šå‚³è‡³ Supabase `user_backups` è¡¨ï¼›ç™»å…¥æ™‚è‡ªå‹•è¼‰å…¥æœ€æ–°å‚™ä»½è¦†è“‹æœ¬åœ°ã€‚

---

## 4. è³‡æ–™æµæµç¨‹åœ– (Data Flow)

ä»¥ä¸‹å±•ç¤º **ã€Œç™»å…¥ä¸¦åŒæ­¥é›²ç«¯è³‡æ–™ã€** æ™‚è™•ç†æµç¨‹ï¼š

```mermaid
sequenceDiagram
    participant User as ğŸ‘¤ ä½¿ç”¨è€…
    participant UI as ğŸ–¥ï¸ ä»‹é¢ (Auth)
    participant JS as âš™ï¸ supabase-sync.js
    participant LS as ğŸ’¾ LocalStorage
    participant DB as â˜ï¸ Supabase DB

    User->>UI: è¼¸å…¥ Email / å¯†ç¢¼ç™»å…¥
    UI->>JS: signInWithPassword()
    JS->>DB: é©—è­‰å¸³å¯†ä¸¦å–å¾— Session (JWT)
    JS->>DB: æŸ¥è©¢ user_backups è³‡æ–™è¡¨
    DB-->>JS: å›å‚³æœ€æ–°çš„ JSONB (app_data)
    JS->>LS: å°‡ app_data è§£æä¸¦å¯«å…¥ LocalStorage
    JS->>UI: è§¸ç™¼ renderAll() é‡æ–°æ¸²æŸ“ç•«é¢
    UI-->>User: é¡¯ç¤ºé›²ç«¯è¦†è“‹å¾Œçš„æœ€æ–°è³‡æ–™ä¸¦æç¤ºæˆåŠŸ
```

---

## 5. è³‡æ–™çµæ§‹å®šç¾© (Data Schema)

### 5.1 Supabase Schema (PostgreSQL)
```sql
CREATE TABLE user_backups (
    user_id UUID REFERENCES auth.users(id) PRIMARY KEY,
    app_data JSONB NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- ä¸¦è¨­å®š Row Level Security (RLS) ç¢ºä¿ç”¨æˆ¶åªèƒ½å­˜å–è‡ªå·±çš„å‚™ä»½
```

### 5.2 LocalStorage ç‹€æ…‹çµæ§‹ (State)
ç³»çµ±çš„æ ¸å¿ƒç‹€æ…‹ (å³å‚™ä»½è‡³é›²ç«¯çš„ JSONB å…§å®¹) å¤§è‡´åŒ…å«ä»¥ä¸‹çµæ§‹ï¼š
```json
{
  "items": [ /* å›ºå®šæ”¯å‡ºé …ç›®é™£åˆ— (åŒ…å« name, category, amount, currency, cycle ç­‰) */ ],
  "categories": [ /* å›ºå®šæ”¯å‡ºåˆ†é¡é™£åˆ— */ ],
  "lifeItems": [ /* ç”Ÿæ´»è²»æ”¶æ”¯ç´€éŒ„é™£åˆ— (å« type: income/expense) */ ],
  "lifeCategories": [ /* ç”Ÿæ´»è²»åˆ†é¡é™£åˆ— (å« type, budget(æœˆé ç®—ä¸Šé™)) */ ],
  "projects": [ /* ç¨ç«‹ä¼åŠƒå°ˆæ¡ˆé™£åˆ— (åŒ…å« budget, startDate, endDate, status) */ ],
  "projectItems": [ /* å°ˆæ¡ˆæ˜ç´°ç´€éŒ„é™£åˆ— (å°ç…§ project.id) */ ],
  "projectCategories": [ /* å°ˆæ¡ˆæ˜ç´°åˆ†é¡é™£åˆ— */ ],
  "wealthParams": { /* è³‡ç”¢è©¦ç®—åƒæ•¸: investRate, cashCurrent, target ç­‰ */ },
  "monthlyIncome": 50000, /* é ä¼°æœˆæœ¬è–ª/æ”¶å…¥ */
  "deductProjectSavings": true /* åˆ†æçœ‹æ¿æ˜¯å¦æ‰£é™¤å°ˆæ¡ˆé å®šé‡‘ */
}
```

---

## 6. å°ˆæ¡ˆæª”æ¡ˆçµæ§‹ (File Structure)

```text
Project Root
â”œâ”€â”€ index.html               # æ‡‰ç”¨ç¨‹å¼å…¥å£ (åŒ…å« UI éª¨æ¶ã€åˆ†é å°èˆªã€Modals)
â”œâ”€â”€ style.css                # æ¨£å¼æ©Ÿåˆ¶ (åŒ…å« CSS è®Šæ•¸ä¸»é¡Œã€RWDã€çµ„ä»¶æ¨£å¼)
â””â”€â”€ js/                      # æ‹†åˆ†æ¨¡çµ„åŒ– JavaScript
    â”œâ”€â”€ state.js             # æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹ç®¡ç† (å…¨åŸŸ state ç‰©ä»¶å®£å‘Š)
    â”œâ”€â”€ data.js              # LocalStorage è®€å–/å„²å­˜ã€CRUD æ ¸å¿ƒè³‡æ–™è™•ç†
    â”œâ”€â”€ utils.js             # å…±ç”¨å·¥å…·å‡½å¼ (UUID ç”Ÿæˆã€é‡‘é¡æ ¼å¼åŒ–)
    â”œâ”€â”€ supabase-config.js   # Supabase åˆå§‹åŒ–è¨­å®š
    â”œâ”€â”€ supabase-sync.js     # Auth èªè­‰èˆ‡é›²ç«¯å‚™ä»½åŒæ­¥é‚è¼¯
    â”œâ”€â”€ ui-fixed.js          # ã€Œå›ºå®šæ”¯å‡ºã€åˆ†é é‚è¼¯
    â”œâ”€â”€ ui-life.js           # ã€Œç”Ÿæ´»è²»è¨˜å¸³ã€åˆ†é é‚è¼¯
    â”œâ”€â”€ ui-analysis.js       # ã€Œæ”¶æ”¯åˆ†æã€åˆ†é é‚è¼¯èˆ‡ Chart.js åœ–è¡¨ç¹ªè£½
    â”œâ”€â”€ ui-wealth.js         # ã€Œè³‡ç”¢è©¦ç®—ã€åˆ†é é‚è¼¯
    â”œâ”€â”€ ui-projects.js       # ã€Œå°ˆæ¡ˆé ç®—ã€åˆ†é é‚è¼¯
    â””â”€â”€ main.js              # å…¨åŸŸäº‹ä»¶ç¶å®šã€åˆå§‹åŒ– (Tab åˆ‡æ›ã€ä¸»é¡Œåˆ‡æ›ç­‰)
```

---

## 7. æœªä¾†æ“´å……å»ºè­° (Possible Enhancements)
*   **PWA (Progressive Web App)**ï¼šæ”¯æ´å®‰è£ç‚ºæ¡Œé¢/æ‰‹æ©Ÿæ‡‰ç”¨ç¨‹å¼ï¼Œä¸¦é…ç½® Service Worker å¯¦è¡Œé›¢ç·šå¿«å–æ”¯æ´ï¼Œæå‡è¡Œå‹•ç«¯é«”é©—ã€‚
*   **AI è¨˜å¸³æ•´åˆ**ï¼šä¸²æ¥ LLM/Vision API (ä¾‹å¦‚ Gemini)ï¼Œå¯¦ç¾ä¸Šå‚³ç™¼ç¥¨ã€æ”¶æ“šæˆ–é£Ÿç‰©ç…§ç‰‡è‡ªå‹•ä¼°ç®—é‡‘é¡ä¸¦ç™»éŒ„è¨˜å¸³ã€‚
*   **å¤šè£ç½®å³æ™‚å”ä½œ**ï¼šé€é Supabase Realtime Channel è¨‚é–±è³‡æ–™åº«è®Šæ›´äº‹ä»¶ï¼Œé”åˆ°è·¨è£ç½®é–‹å•Ÿæ™‚è‡ªå‹•å³æ™‚æ¨æ’­ä¸¦æ›´æ–°ç•«é¢ã€‚
*   **è‡ªå‹•åŒ¯ç‡æ›´æ–°**ï¼šæ•´åˆå…¬é–‹åŒ¯ç‡ API (Exchange Rates API)ï¼Œå®šæœŸè‡ªå‹•æ›´æ–°å¤–å¹£èˆ‡å°å¹£é–“è½‰æ›çš„åŒ¯ç‡ã€‚
